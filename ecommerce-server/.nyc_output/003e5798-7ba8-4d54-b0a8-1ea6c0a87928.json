{"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/service.js":{"path":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/service.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":3,"column":38}},"1":{"start":{"line":5,"column":13},"end":{"line":5,"column":28}},"2":{"start":{"line":7,"column":15},"end":{"line":7,"column":32}},"3":{"start":{"line":9,"column":13},"end":{"line":9,"column":28}},"4":{"start":{"line":11,"column":15},"end":{"line":11,"column":41}},"5":{"start":{"line":13,"column":11},"end":{"line":13,"column":37}},"6":{"start":{"line":15,"column":14},"end":{"line":15,"column":38}},"7":{"start":{"line":17,"column":15},"end":{"line":17,"column":33}},"8":{"start":{"line":19,"column":0},"end":{"line":19,"column":111}},"9":{"start":{"line":20,"column":0},"end":{"line":22,"column":3}},"10":{"start":{"line":24,"column":15},"end":{"line":24,"column":41}},"11":{"start":{"line":26,"column":15},"end":{"line":26,"column":123}},"12":{"start":{"line":27,"column":0},"end":{"line":30,"column":3}},"13":{"start":{"line":28,"column":2},"end":{"line":28,"column":60}},"14":{"start":{"line":29,"column":2},"end":{"line":29,"column":24}},"15":{"start":{"line":31,"column":19},"end":{"line":31,"column":44}},"16":{"start":{"line":32,"column":0},"end":{"line":34,"column":3}},"17":{"start":{"line":33,"column":2},"end":{"line":33,"column":80}},"18":{"start":{"line":36,"column":17},"end":{"line":44,"column":1}},"19":{"start":{"line":37,"column":2},"end":{"line":37,"column":46}},"20":{"start":{"line":38,"column":2},"end":{"line":38,"column":42}},"21":{"start":{"line":39,"column":2},"end":{"line":39,"column":27}},"22":{"start":{"line":40,"column":2},"end":{"line":40,"column":41}},"23":{"start":{"line":41,"column":2},"end":{"line":41,"column":19}},"24":{"start":{"line":42,"column":2},"end":{"line":42,"column":36}},"25":{"start":{"line":43,"column":2},"end":{"line":43,"column":18}},"26":{"start":{"line":46,"column":0},"end":{"line":46,"column":32}},"27":{"start":{"line":47,"column":0},"end":{"line":47,"column":31}},"28":{"start":{"line":48,"column":0},"end":{"line":48,"column":39}},"29":{"start":{"line":49,"column":0},"end":{"line":49,"column":42}},"30":{"start":{"line":50,"column":0},"end":{"line":50,"column":43}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":27,"column":24},"end":{"line":27,"column":25}},"loc":{"start":{"line":27,"column":36},"end":{"line":30,"column":1}},"line":27},"1":{"name":"(anonymous_1)","decl":{"start":{"line":32,"column":36},"end":{"line":32,"column":37}},"loc":{"start":{"line":32,"column":42},"end":{"line":34,"column":1}},"line":32},"2":{"name":"(anonymous_2)","decl":{"start":{"line":36,"column":17},"end":{"line":36,"column":18}},"loc":{"start":{"line":36,"column":29},"end":{"line":44,"column":1}},"line":36}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":1,"27":1,"28":1,"29":1,"30":1},"f":{"0":1,"1":1,"2":0},"b":{},"inputSourceMap":{"version":3,"sources":["service.js"],"names":["http","require","dotenv","path","logger","db","utils","server","info","process","env","NODE_ENV","config","resolve","cwd","DB_URI","mongodb","host","port","dbName","connect","then","initSKU","httpServer","createServer","listen","PORT","shutDown","close","exit","on","module","exports"],"mappings":"AAAA;;;;AACA,MAAMA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAApB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAAtB;;AACA,MAAME,IAAI,GAAGF,OAAO,CAAC,MAAD,CAApB;;AACA,MAAMG,MAAM,GAAGH,OAAO,CAAC,iBAAD,CAAtB;;AACA,MAAMI,EAAE,GAAGJ,OAAO,CAAC,iBAAD,CAAlB;;AACA,MAAMK,KAAK,GAAGL,OAAO,CAAC,eAAD,CAArB;;AACA,MAAMM,MAAM,GAAGN,OAAO,CAAC,SAAD,CAAtB;;AAEAG,MAAM,CAACI,IAAP,mEAAuEC,OAAO,CAACC,GAAR,CAAYC,QAAnF;AACAT,MAAM,CAACU,MAAP,CAAc;AACZT,EAAAA,IAAI,EAAEA,IAAI,CAACU,OAAL,CAAaJ,OAAO,CAACK,GAAR,EAAb,2BAA8CL,OAAO,CAACC,GAAR,CAAYC,QAA1D;AADM,CAAd;;AAIA,MAAMC,MAAM,GAAGX,OAAO,CAAC,iBAAD,CAAtB;;AACA,MAAMc,MAAM,uBAAgBH,MAAM,CAACI,OAAP,CAAeC,IAA/B,cAAuCL,MAAM,CAACI,OAAP,CAAeE,IAAtD,cAA8DN,MAAM,CAACI,OAAP,CAAeG,MAA7E,CAAZ;AACAd,EAAE,CAACe,OAAH,CAAWL,MAAX,EAAmBM,IAAnB,CAAwB,YAAY;AAClCjB,EAAAA,MAAM,CAACI,IAAP,sCAA0CO,MAA1C;AACA,QAAMT,KAAK,CAACgB,OAAN,EAAN;AACD,CAHD;AAKA,MAAMC,UAAU,GAAGvB,IAAI,CAACwB,YAAL,CAAkBjB,MAAlB,CAAnB;AACAgB,UAAU,CAACE,MAAX,CAAkBhB,OAAO,CAACC,GAAR,CAAYgB,IAA9B,EAAoC,MAAM;AACxCtB,EAAAA,MAAM,CAACI,IAAP,gDAAoDC,OAAO,CAACC,GAAR,CAAYgB,IAAhE;AACD,CAFD;;AAIA,MAAMC,QAAQ,GAAG,YAAY;AAC3BvB,EAAAA,MAAM,CAACI,IAAP,CAAY,8BAAZ;AACAJ,EAAAA,MAAM,CAACI,IAAP,CAAY,0BAAZ;AACA,QAAMe,UAAU,CAACK,KAAX,EAAN;AACAxB,EAAAA,MAAM,CAACI,IAAP,CAAY,yBAAZ;AACA,QAAMH,EAAE,CAACuB,KAAH,EAAN;AACAxB,EAAAA,MAAM,CAACI,IAAP,CAAY,oBAAZ;AACAC,EAAAA,OAAO,CAACoB,IAAR,CAAa,CAAb;AACD,CARD;;AAUApB,OAAO,CAACqB,EAAR,CAAW,SAAX,EAAsBH,QAAtB;AACAlB,OAAO,CAACqB,EAAR,CAAW,QAAX,EAAqBH,QAArB;AAEAI,MAAM,CAACC,OAAP,CAAed,IAAf,GAAsBT,OAAO,CAACC,GAAR,CAAYgB,IAAlC;AACAK,MAAM,CAACC,OAAP,CAAetB,GAAf,GAAqBD,OAAO,CAACC,GAAR,CAAYC,QAAjC;AACAoB,MAAM,CAACC,OAAP,CAAejB,MAAf,GAAwBN,OAAO,CAACC,GAAR,CAAYK,MAApC","sourceRoot":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/","sourcesContent":["'use strict';\nconst http = require('http');\nconst dotenv = require('dotenv');\nconst path = require('path');\nconst logger = require('./logger/logger');\nconst db = require('./components/db');\nconst utils = require('./utils/utils');\nconst server = require('./index');\n\nlogger.info(`[+] Loading Environment Variables from '../environments/${process.env.NODE_ENV}/.env'`);\ndotenv.config({\n  path: path.resolve(process.cwd(), `./environments/${process.env.NODE_ENV}/.env`),\n});\n\nconst config = require('./config/config');\nconst DB_URI = `mongodb://${config.mongodb.host}:${config.mongodb.port}/${config.mongodb.dbName}`;\ndb.connect(DB_URI).then(async () => {\n  logger.info(`[+] Connected to MongoD at ${DB_URI}`);\n  await utils.initSKU();\n});\n\nconst httpServer = http.createServer(server);\nhttpServer.listen(process.env.PORT, () => {\n  logger.info(`[+] ECommerce server running on port ${process.env.PORT}`);\n});\n\nconst shutDown = async () => {\n  logger.info('[+] SIGTERM signal received.');\n  logger.info('[+] Closing http server.');\n  await httpServer.close();\n  logger.info('[+] Http server closed.');\n  await db.close();\n  logger.info('[+] MongoDB closed');\n  process.exit(0);\n};\n\nprocess.on('SIGTERM', shutDown);\nprocess.on('SIGINT', shutDown);\n\nmodule.exports.port = process.env.PORT;\nmodule.exports.env = process.env.NODE_ENV;\nmodule.exports.DB_URI = process.env.DB_URI;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f0ce6240c4b01d9279c574368ae06c62e70777c6","contentHash":"d6b65b2cca9fa29c42851c191c04ad6d9ffb9ea183e638ed789d47b497fd62a4"},"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/logger/logger.js":{"path":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/logger/logger.js","statementMap":{"0":{"start":{"line":7,"column":4},"end":{"line":7,"column":22}},"1":{"start":{"line":9,"column":20},"end":{"line":9,"column":49}},"2":{"start":{"line":17,"column":4},"end":{"line":17,"column":10}},"3":{"start":{"line":18,"column":22},"end":{"line":26,"column":2}},"4":{"start":{"line":24,"column":6},"end":{"line":24,"column":10}},"5":{"start":{"line":25,"column":2},"end":{"line":25,"column":101}},"6":{"start":{"line":27,"column":15},"end":{"line":52,"column":2}},"7":{"start":{"line":53,"column":0},"end":{"line":56,"column":4}},"8":{"start":{"line":57,"column":0},"end":{"line":57,"column":24}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":18,"column":29},"end":{"line":18,"column":30}},"loc":{"start":{"line":18,"column":39},"end":{"line":26,"column":1}},"line":18}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":74,"5":74,"6":1,"7":1,"8":1},"f":{"0":74},"b":{},"inputSourceMap":{"version":3,"sources":["logger.js"],"names":["createLogger","format","transports","require","packageJson","combine","timestamp","label","printf","colorize","defaultFormat","level","message","logger","name","Console","File","filename","add","simple","module","exports"],"mappings":"AAAA;;AACA,MAAM;AAAEA,EAAAA,YAAF;AAAgBC,EAAAA,MAAhB;AAAwBC,EAAAA;AAAxB,IAAuCC,OAAO,CAAC,SAAD,CAApD;;AACA,MAAMC,WAAW,GAAGD,OAAO,CAAC,oBAAD,CAA3B;;AAEA,MAAM;AAAEE,EAAAA,OAAF;AAAWC,EAAAA,SAAX;AAAsBC,EAAAA,KAAtB;AAA6BC,EAAAA,MAA7B;AAAqCC,EAAAA;AAArC,IAAkDR,MAAxD;AACA,MAAMS,aAAa,GAAGF,MAAM,CAAC,UAA0C;AAAA,MAAzC;AAAEG,IAAAA,KAAF;AAASC,IAAAA,OAAT;AAAkBL,IAAAA,KAAlB;AAAyBD,IAAAA;AAAzB,GAAyC;AACrE,oBAAWC,KAAX,mBAAyBI,KAAzB,iBAAqCL,SAArC,iBAAqDM,OAArD;AACD,CAF2B,CAA5B;AAIA,MAAMC,MAAM,GAAGb,YAAY,CAAC;AAC1BC,EAAAA,MAAM,EAAEI,OAAO,CAACE,KAAK,CAAC;AAAEA,IAAAA,KAAK,EAAEH,WAAW,CAACU;AAArB,GAAD,CAAN,EAAqCR,SAAS,EAA9C,EAAkDI,aAAlD,EAAiED,QAAQ,EAAzE,CADW;AAE1BP,EAAAA,UAAU,EAAE,CACV;;AACA;;;;;;;;AAQA;AACA,MAAIA,UAAU,CAACa,OAAf,CAAuB;AAAEJ,IAAAA,KAAK,EAAE;AAAT,GAAvB,CAXU,EAWkC;AAC5C,MAAIT,UAAU,CAACc,IAAf,CAAoB;AAClBC,IAAAA,QAAQ,mBAAYb,WAAW,CAACU,IAAxB,cAAgCV,WAAW,CAACU,IAA5C,kBADU;AAElBH,IAAAA,KAAK,EAAE;AAFW,GAApB,CAZU,EAgBV,IAAIT,UAAU,CAACc,IAAf,CAAoB;AAClBC,IAAAA,QAAQ,mBAAYb,WAAW,CAACU,IAAxB,cAAgCV,WAAW,CAACU,IAA5C,eADU;AAElBH,IAAAA,KAAK,EAAE;AAFW,GAApB,CAhBU;AAFc,CAAD,CAA3B;AAyBAE,MAAM,CAACK,GAAP,CACE,IAAIhB,UAAU,CAACa,OAAf,CAAuB;AACrBd,EAAAA,MAAM,EAAEA,MAAM,CAACkB,MAAP,EADa;AAErBR,EAAAA,KAAK,EAAE;AAFc,CAAvB,CADF;AAOAS,MAAM,CAACC,OAAP,GAAiBR,MAAjB","sourceRoot":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/logger/","sourcesContent":["'use strict';\nconst { createLogger, format, transports } = require('winston');\nconst packageJson = require('../../package.json');\n\nconst { combine, timestamp, label, printf, colorize } = format;\nconst defaultFormat = printf(({ level, message, label, timestamp }) => {\n  return `[${label}]  <  ${level} >  ${timestamp} |  ${message}`;\n});\n\nconst logger = createLogger({\n  format: combine(label({ label: packageJson.name }), timestamp(), defaultFormat, colorize()),\n  transports: [\n    // eslint-disable-next-line lines-around-comment\n    /* {\n      error: 0,\n      warn: 1,\n      info: 2,\n      verbose: 3,\n      debug: 4,\n      silly: 5\n    } */\n    // eslint-disable-next-line no-inline-comments\n    new transports.Console({ level: 'debug' }), // warnings and errors\n    new transports.File({\n      filename: `./logs/${packageJson.name}/${packageJson.name}_combined.log`,\n      level: 'debug',\n    }),\n    new transports.File({\n      filename: `./logs/${packageJson.name}/${packageJson.name}_error.log`,\n      level: 'error',\n    }),\n  ],\n});\n\nlogger.add(\n  new transports.Console({\n    format: format.simple(),\n    level: 'error',\n  })\n);\n\nmodule.exports = logger;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"fbc1b497be5e7f08cdce900be412578b878e5f88","contentHash":"a8678a099f623ffaf41ca7a5db9337845be38e36d7186d74bdc0310c48ba0aae"},"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/components/db.js":{"path":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/components/db.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":3,"column":38}},"1":{"start":{"line":5,"column":17},"end":{"line":5,"column":36}},"2":{"start":{"line":7,"column":15},"end":{"line":7,"column":42}},"3":{"start":{"line":14,"column":0},"end":{"line":28,"column":2}},"4":{"start":{"line":15,"column":2},"end":{"line":27,"column":5}},"5":{"start":{"line":16,"column":4},"end":{"line":26,"column":7}},"6":{"start":{"line":22,"column":6},"end":{"line":22,"column":16}},"7":{"start":{"line":24,"column":6},"end":{"line":24,"column":99}},"8":{"start":{"line":25,"column":6},"end":{"line":25,"column":21}},"9":{"start":{"line":34,"column":0},"end":{"line":36,"column":2}},"10":{"start":{"line":35,"column":2},"end":{"line":35,"column":48}},"11":{"start":{"line":42,"column":0},"end":{"line":44,"column":2}},"12":{"start":{"line":43,"column":2},"end":{"line":43,"column":53}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":14,"column":18},"end":{"line":14,"column":19}},"loc":{"start":{"line":14,"column":28},"end":{"line":28,"column":1}},"line":14},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":21},"end":{"line":15,"column":22}},"loc":{"start":{"line":15,"column":32},"end":{"line":27,"column":3}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":21,"column":12},"end":{"line":21,"column":13}},"loc":{"start":{"line":21,"column":18},"end":{"line":23,"column":5}},"line":21},"3":{"name":"(anonymous_3)","decl":{"start":{"line":23,"column":13},"end":{"line":23,"column":14}},"loc":{"start":{"line":23,"column":20},"end":{"line":26,"column":5}},"line":23},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":16},"end":{"line":34,"column":17}},"loc":{"start":{"line":34,"column":28},"end":{"line":36,"column":1}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":42,"column":23},"end":{"line":42,"column":24}},"loc":{"start":{"line":42,"column":35},"end":{"line":44,"column":1}},"line":42}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":0,"9":1,"10":0,"11":1,"12":1},"f":{"0":1,"1":1,"2":1,"3":0,"4":0,"5":1},"b":{},"inputSourceMap":{"version":3,"sources":["db.js"],"names":["mongoose","require","logger","exports","connect","DB_URI","Promise","resolve","useNewUrlParser","useCreateIndex","useFindAndModify","useUnifiedTopology","then","catch","err","error","process","exit","close","connection","dropDatabase","db"],"mappings":"AAAA;;;;AACA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAD,CAAxB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,kBAAD,CAAtB;AAEA;;;;;;AAKAE,OAAO,CAACC,OAAR,GAAmBC,MAAD,IAAY;AAC5B,SAAO,IAAIC,OAAJ,CAAaC,OAAD,IAAa;AAC9BP,IAAAA,QAAQ,CACLI,OADH,CACWC,MADX,EACmB;AACfG,MAAAA,eAAe,EAAE,IADF;AAEfC,MAAAA,cAAc,EAAE,IAFD;AAGfC,MAAAA,gBAAgB,EAAE,KAHH;AAIfC,MAAAA,kBAAkB,EAAE;AAJL,KADnB,EAOGC,IAPH,CAOQ,MAAM;AACVL,MAAAA,OAAO;AACR,KATH,EAUGM,KAVH,CAUUC,GAAD,IAAS;AACdZ,MAAAA,MAAM,CAACa,KAAP,4CAAiDV,MAAjD,yBAAsES,GAAtE;AACAE,MAAAA,OAAO,CAACC,IAAR;AACD,KAbH;AAcD,GAfM,CAAP;AAgBD,CAjBD;AAmBA;;;;;AAIAd,OAAO,CAACe,KAAR,GAAgB,YAAY;AAC1B,SAAO,MAAMlB,QAAQ,CAACmB,UAAT,CAAoBD,KAApB,CAA0B,KAA1B,CAAb;AACD,CAFD;AAIA;;;;;AAIAf,OAAO,CAACiB,YAAR,GAAuB,YAAY;AACjC,SAAO,MAAMpB,QAAQ,CAACmB,UAAT,CAAoBE,EAApB,CAAuBD,YAAvB,EAAb;AACD,CAFD","sourceRoot":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/components/","sourcesContent":["'use strict';\nconst mongoose = require('mongoose');\nconst logger = require('../logger/logger');\n\n/**\n * Connect with the MongoDB with given DB_URI\n * @param {DB_URI}\n */\n\nexports.connect = (DB_URI) => {\n  return new Promise((resolve) => {\n    mongoose\n      .connect(DB_URI, {\n        useNewUrlParser: true,\n        useCreateIndex: true,\n        useFindAndModify: false,\n        useUnifiedTopology: true,\n      })\n      .then(() => {\n        resolve();\n      })\n      .catch((err) => {\n        logger.error(`[+] Failed to connect to MongoDB ${DB_URI} with error ${err}`);\n        process.exit();\n      });\n  });\n};\n\n/** Close the MongoDB connection.\n * @return {promise}\n */\n\nexports.close = async () => {\n  return await mongoose.connection.close(false);\n};\n\n/** dropDatabase the MongoDB connection.\n * @return {promise}\n */\n\nexports.dropDatabase = async () => {\n  return await mongoose.connection.db.dropDatabase();\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"11c6609eb48b3ed91d1671fefced96817c01d8c5","contentHash":"32660dc2c1088198ac7c6a2fff9732514befecf74e1aa551214b78984b5affba"},"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/utils/utils.js":{"path":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/utils/utils.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":3,"column":38}},"1":{"start":{"line":5,"column":13},"end":{"line":5,"column":28}},"2":{"start":{"line":7,"column":15},"end":{"line":7,"column":42}},"3":{"start":{"line":9,"column":20},"end":{"line":9,"column":52}},"4":{"start":{"line":11,"column":12},"end":{"line":11,"column":36}},"5":{"start":{"line":21,"column":24},"end":{"line":30,"column":1}},"6":{"start":{"line":22,"column":16},"end":{"line":22,"column":88}},"7":{"start":{"line":23,"column":13},"end":{"line":23,"column":85}},"8":{"start":{"line":24,"column":2},"end":{"line":29,"column":5}},"9":{"start":{"line":40,"column":22},"end":{"line":49,"column":1}},"10":{"start":{"line":41,"column":15},"end":{"line":41,"column":86}},"11":{"start":{"line":42,"column":13},"end":{"line":42,"column":85}},"12":{"start":{"line":43,"column":2},"end":{"line":48,"column":5}},"13":{"start":{"line":59,"column":26},"end":{"line":73,"column":1}},"14":{"start":{"line":62,"column":23},"end":{"line":62,"column":56}},"15":{"start":{"line":64,"column":2},"end":{"line":72,"column":3}},"16":{"start":{"line":65,"column":4},"end":{"line":69,"column":5}},"17":{"start":{"line":68,"column":6},"end":{"line":68,"column":13}},"18":{"start":{"line":71,"column":4},"end":{"line":71,"column":41}},"19":{"start":{"line":79,"column":16},"end":{"line":85,"column":1}},"20":{"start":{"line":80,"column":17},"end":{"line":80,"column":43}},"21":{"start":{"line":82,"column":2},"end":{"line":84,"column":3}},"22":{"start":{"line":83,"column":4},"end":{"line":83,"column":20}},"23":{"start":{"line":94,"column":16},"end":{"line":99,"column":1}},"24":{"start":{"line":95,"column":2},"end":{"line":95,"column":57}},"25":{"start":{"line":96,"column":2},"end":{"line":96,"column":38}},"26":{"start":{"line":97,"column":13},"end":{"line":97,"column":31}},"27":{"start":{"line":98,"column":2},"end":{"line":98,"column":14}},"28":{"start":{"line":108,"column":20},"end":{"line":111,"column":1}},"29":{"start":{"line":109,"column":2},"end":{"line":109,"column":56}},"30":{"start":{"line":110,"column":2},"end":{"line":110,"column":25}},"31":{"start":{"line":120,"column":16},"end":{"line":135,"column":1}},"32":{"start":{"line":121,"column":2},"end":{"line":134,"column":5}},"33":{"start":{"line":122,"column":4},"end":{"line":122,"column":138}},"34":{"start":{"line":123,"column":14},"end":{"line":123,"column":23}},"35":{"start":{"line":124,"column":4},"end":{"line":124,"column":23}},"36":{"start":{"line":125,"column":4},"end":{"line":125,"column":25}},"37":{"start":{"line":126,"column":4},"end":{"line":126,"column":27}},"38":{"start":{"line":127,"column":4},"end":{"line":127,"column":23}},"39":{"start":{"line":129,"column":4},"end":{"line":133,"column":5}},"40":{"start":{"line":130,"column":6},"end":{"line":130,"column":23}},"41":{"start":{"line":132,"column":6},"end":{"line":132,"column":66}},"42":{"start":{"line":144,"column":19},"end":{"line":168,"column":1}},"43":{"start":{"line":145,"column":2},"end":{"line":167,"column":5}},"44":{"start":{"line":146,"column":4},"end":{"line":146,"column":108}},"45":{"start":{"line":147,"column":19},"end":{"line":149,"column":5}},"46":{"start":{"line":150,"column":19},"end":{"line":152,"column":5}},"47":{"start":{"line":154,"column":4},"end":{"line":166,"column":5}},"48":{"start":{"line":155,"column":16},"end":{"line":155,"column":41}},"49":{"start":{"line":156,"column":21},"end":{"line":156,"column":30}},"50":{"start":{"line":157,"column":6},"end":{"line":161,"column":9}},"51":{"start":{"line":162,"column":6},"end":{"line":162,"column":38}},"52":{"start":{"line":163,"column":6},"end":{"line":163,"column":129}},"53":{"start":{"line":165,"column":6},"end":{"line":165,"column":66}},"54":{"start":{"line":170,"column":0},"end":{"line":170,"column":42}},"55":{"start":{"line":171,"column":0},"end":{"line":171,"column":38}},"56":{"start":{"line":172,"column":0},"end":{"line":172,"column":46}},"57":{"start":{"line":173,"column":0},"end":{"line":173,"column":26}},"58":{"start":{"line":174,"column":0},"end":{"line":174,"column":34}},"59":{"start":{"line":175,"column":0},"end":{"line":175,"column":26}},"60":{"start":{"line":176,"column":0},"end":{"line":176,"column":26}},"61":{"start":{"line":177,"column":0},"end":{"line":177,"column":32}}},"fnMap":{"0":{"name":"successResponse","decl":{"start":{"line":21,"column":33},"end":{"line":21,"column":48}},"loc":{"start":{"line":21,"column":59},"end":{"line":30,"column":1}},"line":21},"1":{"name":"errorResponse","decl":{"start":{"line":40,"column":31},"end":{"line":40,"column":44}},"loc":{"start":{"line":40,"column":64},"end":{"line":49,"column":1}},"line":40},"2":{"name":"(anonymous_2)","decl":{"start":{"line":59,"column":26},"end":{"line":59,"column":27}},"loc":{"start":{"line":59,"column":55},"end":{"line":73,"column":1}},"line":59},"3":{"name":"(anonymous_3)","decl":{"start":{"line":79,"column":16},"end":{"line":79,"column":17}},"loc":{"start":{"line":79,"column":28},"end":{"line":85,"column":1}},"line":79},"4":{"name":"(anonymous_4)","decl":{"start":{"line":94,"column":16},"end":{"line":94,"column":17}},"loc":{"start":{"line":94,"column":28},"end":{"line":99,"column":1}},"line":94},"5":{"name":"(anonymous_5)","decl":{"start":{"line":108,"column":20},"end":{"line":108,"column":21}},"loc":{"start":{"line":108,"column":32},"end":{"line":111,"column":1}},"line":108},"6":{"name":"(anonymous_6)","decl":{"start":{"line":120,"column":16},"end":{"line":120,"column":17}},"loc":{"start":{"line":120,"column":28},"end":{"line":135,"column":1}},"line":120},"7":{"name":"(anonymous_7)","decl":{"start":{"line":121,"column":22},"end":{"line":121,"column":23}},"loc":{"start":{"line":121,"column":36},"end":{"line":134,"column":3}},"line":121},"8":{"name":"(anonymous_8)","decl":{"start":{"line":144,"column":19},"end":{"line":144,"column":20}},"loc":{"start":{"line":144,"column":34},"end":{"line":168,"column":1}},"line":144},"9":{"name":"(anonymous_9)","decl":{"start":{"line":145,"column":16},"end":{"line":145,"column":17}},"loc":{"start":{"line":145,"column":30},"end":{"line":167,"column":3}},"line":145}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":16},"end":{"line":22,"column":88}},"type":"cond-expr","locations":[{"start":{"line":22,"column":69},"end":{"line":22,"column":81}},{"start":{"line":22,"column":84},"end":{"line":22,"column":88}}],"line":22},"1":{"loc":{"start":{"line":22,"column":16},"end":{"line":22,"column":66}},"type":"binary-expr","locations":[{"start":{"line":22,"column":16},"end":{"line":22,"column":36}},{"start":{"line":22,"column":40},"end":{"line":22,"column":66}}],"line":22},"2":{"loc":{"start":{"line":23,"column":13},"end":{"line":23,"column":85}},"type":"cond-expr","locations":[{"start":{"line":23,"column":66},"end":{"line":23,"column":78}},{"start":{"line":23,"column":81},"end":{"line":23,"column":85}}],"line":23},"3":{"loc":{"start":{"line":23,"column":13},"end":{"line":23,"column":63}},"type":"binary-expr","locations":[{"start":{"line":23,"column":13},"end":{"line":23,"column":33}},{"start":{"line":23,"column":37},"end":{"line":23,"column":63}}],"line":23},"4":{"loc":{"start":{"line":41,"column":15},"end":{"line":41,"column":86}},"type":"cond-expr","locations":[{"start":{"line":41,"column":68},"end":{"line":41,"column":80}},{"start":{"line":41,"column":83},"end":{"line":41,"column":86}}],"line":41},"5":{"loc":{"start":{"line":41,"column":15},"end":{"line":41,"column":65}},"type":"binary-expr","locations":[{"start":{"line":41,"column":15},"end":{"line":41,"column":35}},{"start":{"line":41,"column":39},"end":{"line":41,"column":65}}],"line":41},"6":{"loc":{"start":{"line":42,"column":13},"end":{"line":42,"column":85}},"type":"cond-expr","locations":[{"start":{"line":42,"column":66},"end":{"line":42,"column":78}},{"start":{"line":42,"column":81},"end":{"line":42,"column":85}}],"line":42},"7":{"loc":{"start":{"line":42,"column":13},"end":{"line":42,"column":63}},"type":"binary-expr","locations":[{"start":{"line":42,"column":13},"end":{"line":42,"column":33}},{"start":{"line":42,"column":37},"end":{"line":42,"column":63}}],"line":42},"8":{"loc":{"start":{"line":64,"column":2},"end":{"line":72,"column":3}},"type":"if","locations":[{"start":{"line":64,"column":2},"end":{"line":72,"column":3}},{"start":{"line":64,"column":2},"end":{"line":72,"column":3}}],"line":64},"9":{"loc":{"start":{"line":65,"column":4},"end":{"line":69,"column":5}},"type":"if","locations":[{"start":{"line":65,"column":4},"end":{"line":69,"column":5}},{"start":{"line":65,"column":4},"end":{"line":69,"column":5}}],"line":65},"10":{"loc":{"start":{"line":82,"column":2},"end":{"line":84,"column":3}},"type":"if","locations":[{"start":{"line":82,"column":2},"end":{"line":84,"column":3}},{"start":{"line":82,"column":2},"end":{"line":84,"column":3}}],"line":82}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":8,"7":8,"8":8,"9":1,"10":0,"11":0,"12":0,"13":1,"14":0,"15":0,"16":0,"17":0,"18":0,"19":1,"20":4,"21":4,"22":3,"23":1,"24":5,"25":5,"26":5,"27":5,"28":1,"29":3,"30":3,"31":1,"32":3,"33":12,"34":12,"35":12,"36":12,"37":12,"38":12,"39":12,"40":12,"41":0,"42":1,"43":1,"44":2,"45":2,"46":2,"47":2,"48":2,"49":2,"50":2,"51":2,"52":2,"53":0,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1,"61":1},"f":{"0":8,"1":0,"2":0,"3":4,"4":5,"5":3,"6":3,"7":12,"8":1,"9":2},"b":{"0":[8,0],"1":[8,8],"2":[8,0],"3":[8,8],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[3,1]},"inputSourceMap":{"version":3,"sources":["utils.js"],"names":["util","require","logger","initialData","SKU","successResponse","response","message","data","status","send","success","timestamp","Date","now","errorResponse","verifyAccessToken","request","next","serverHeader","headers","initSKU","number","countDocuments","addSKUs","getSKUs","info","find","promisify","skus","cleanUpSKUs","deleteMany","forEach","sku","name","price","img","save","err","error","upsertSKUs","items","filter","update","doc","findOne","oldPrice","findOneAndUpdate","new","upsert","exports"],"mappings":"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","sourceRoot":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/utils/","sourcesContent":["'use strict';\nconst util = require('util');\nconst logger = require('../logger/logger');\nconst initialData = require('../models/initialdata');\nconst SKU = require('../models/sku');\n\n/**\n * Enriched Success response for the client\n * @param {response} request from the client app\n * @param {message} message string for the client app\n * @param {data} response object for the client app\n * @return {response object}\n */\n\nconst successResponse = (response, message = null, data = null) => {\n  response.status(200).send({\n    success: true,\n    timestamp: Date.now(),\n    message,\n    data,\n  });\n};\n\n/**\n * Enriched error response for the client\n * @param {response} request from the client app\n * @param {message} message string for the client app\n * @param {status} 403 status for the client app\n * @return {response object}\n */\n\nconst errorResponse = (response, message, status = 403, data = null) => {\n  response.status(status).send({\n    success: false,\n    timestamp: Date.now(),\n    message,\n    data\n  });\n};\n\n/**\n * FORMAT OF TOKEN x-access-token\n * @param {response} request from the client app\n * @param {message} message string for the client app\n * @param {status} 403 status for the client app\n * @return {response object}\n */\n\nconst verifyAccessToken = (request, response, next) => {\n  // Get auth header value\n  // eslint-disable-next-line space-infix-ops\n  const serverHeader = request.headers['x-access-token'];\n\n  // Check if server is undefined\n  if (typeof serverHeader !== 'undefined') {\n    if (serverHeader === 'sjd1HfkjU83ksdsm3802k') {\n      // Next middleware\n      // eslint-disable-next-line callback-return\n      next();\n    }\n  } else {\n    errorResponse(response, 'Forbidden');\n  }\n};\n\n/**\n Insert SKU with initial data\n */\n\nconst initSKU = async () => {\n  const number = await SKU.countDocuments();\n  if (number <= 0) {\n    await addSKUs();\n  }\n};\n\n/**\n * Retrieve all skus from the MongoDB.\n * @param {request} request from the client app\n * @param {response} response object for the client app\n * @return {response object}\n */\n\nconst getSKUs = async () => {\n  logger.info('[+] SKUs to look from ECommerce Service');\n  SKU.find = util.promisify(SKU.find);\n  let skus = await SKU.find({});\n  return skus;\n};\n\n/**\n * Delete all skus from the MongoDB.\n * @param {request} request from the client app\n * @param {response} response object for the client app\n * @return {response object}\n */\n\nconst cleanUpSKUs = async () => {\n  logger.info('[+] Delete SKUs from ECommerce Service');\n  await SKU.deleteMany();\n};\n\n/**\n * Add new skus from initial data to the MongoDB.\n * @param {request} request from the client app\n * @param {response} response object for the client app\n * @return {response object}\n */\n\nconst addSKUs = async () => {\n  initialData.forEach(async (data) => {\n    logger.info(`[+] ECommerce service added. ${data.sku}, ${data.name}, ${data.price}, ${data.img}`);\n    var sku = new SKU();\n    sku.sku = data.sku;\n    sku.name = data.name;\n    sku.price = data.price;\n    sku.img = data.img;\n    try {\n      await sku.save();\n    } catch (err) {\n      logger.error(`[+] addSKU -- error adding sku ${err}`);\n    }\n  });\n};\n\n/**\n * Add new skus from initial data to the MongoDB.\n * @param {request} request from the client app\n * @param {response} response object for the client app\n * @return {response object}\n */\n\nconst upsertSKUs = async (items) => {\n  items.forEach(async (data) => {\n    logger.info(`[+] ECommerce service to be updated/inserted. ${data.sku}, ${data.price}`);\n    const filter = { sku: data.sku };\n    const update = { price: data.price };\n    try {\n      let doc = await SKU.findOne(filter);\n      let oldPrice = doc.price;\n      doc = await SKU.findOneAndUpdate(filter, update, {\n        new: true,\n        upsert: true // Make this update into an upsert\n      });\n      doc = await SKU.findOne(filter);\n      logger.info(`[+] ${data.sku} old price was ${oldPrice} and now, new price is ${doc.price} `);\n    } catch (err) {\n      logger.error(`[+] addSKU -- error adding sku ${err}`);\n    }\n  });\n};\n\nexports.successResponse = successResponse;\nexports.errorResponse = errorResponse;\nexports.verifyAccessToken = verifyAccessToken;\nexports.initSKU = initSKU;\nexports.cleanUpSKUs = cleanUpSKUs;\nexports.getSKUs = getSKUs;\nexports.addSKUs = addSKUs;\nexports.upsertSKUs = upsertSKUs;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"98d856af3b5892c14c15b3b8f35fb51c1735565b","contentHash":"62d7d2f723c01e723046d9bdea6e5cf207a80cfc244eee67b4a12247e38f9806"},"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/models/initialdata.js":{"path":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/models/initialdata.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":23,"column":3}}},"fnMap":{},"branchMap":{},"s":{"0":1},"f":{},"b":{},"inputSourceMap":{"version":3,"sources":["initialdata.js"],"names":["module","exports","sku","name","price","img"],"mappings":";;AAAAA,MAAM,CAACC,OAAP,GAAiB,CACf;AACEC,EAAAA,GAAG,EAAE,KADP;AAEEC,EAAAA,IAAI,EAAE,YAFR;AAGEC,EAAAA,KAAK,EAAE,MAHT;AAIEC,EAAAA,GAAG,EAAE;AAJP,CADe,EAOf;AACEH,EAAAA,GAAG,EAAE,KADP;AAEEC,EAAAA,IAAI,EAAE,aAFR;AAGEC,EAAAA,KAAK,EAAE,OAHT;AAIEC,EAAAA,GAAG,EAAE;AAJP,CAPe,EAaf;AACEH,EAAAA,GAAG,EAAE,KADP;AAEEC,EAAAA,IAAI,EAAE,UAFR;AAGEC,EAAAA,KAAK,EAAE,KAHT;AAIEC,EAAAA,GAAG,EAAE;AAJP,CAbe,EAmBf;AACEH,EAAAA,GAAG,EAAE,KADP;AAEEC,EAAAA,IAAI,EAAE,aAFR;AAGEC,EAAAA,KAAK,EAAE,IAHT;AAIEC,EAAAA,GAAG,EAAE;AAJP,CAnBe,CAAjB","sourceRoot":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/models/","sourcesContent":["module.exports = [\n  {\n    sku: 'ipd',\n    name: 'Super iPad',\n    price: 549.99,\n    img: './images/image1.jpg'\n  },\n  {\n    sku: 'mbp',\n    name: 'MacBook Pro',\n    price: 1399.99,\n    img: './images/image2.jpg'\n  },\n  {\n    sku: 'atv',\n    name: 'Apple TV',\n    price: 109.5,\n    img: './images/image3.jpg'\n  },\n  {\n    sku: 'vga',\n    name: 'VGA adapter',\n    price: 30.0,\n    img: './images/image4.jpg'\n  }\n];\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d9102dd737574aeeb48a26c87446ac0f36fbed63","contentHash":"1dbc6d4cad56ccd7387eba349f8bc8004186e6c41b06cbf8f21b9b65eedf5ede"},"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/models/sku.js":{"path":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/models/sku.js","statementMap":{"0":{"start":{"line":3,"column":17},"end":{"line":3,"column":36}},"1":{"start":{"line":5,"column":15},"end":{"line":5,"column":30}},"2":{"start":{"line":6,"column":18},"end":{"line":25,"column":2}},"3":{"start":{"line":26,"column":0},"end":{"line":26,"column":50}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1},"f":{},"b":{},"inputSourceMap":{"version":3,"sources":["sku.js"],"names":["mongoose","require","Schema","skuSchema","sku","type","String","required","name","price","img","timestamps","module","exports","model"],"mappings":"AAAA;;AACA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAD,CAAxB;;AACA,MAAMC,MAAM,GAAGF,QAAQ,CAACE,MAAxB;AAEA,MAAMC,SAAS,GAAG,IAAID,MAAJ,CAChB;AACEE,EAAAA,GAAG,EAAE;AACHC,IAAAA,IAAI,EAAEC,MADH;AAEHC,IAAAA,QAAQ,EAAE;AAFP,GADP;AAKEC,EAAAA,IAAI,EAAE;AACJH,IAAAA,IAAI,EAAEC,MADF;AAEJC,IAAAA,QAAQ,EAAE;AAFN,GALR;AASEE,EAAAA,KAAK,EAAE;AACLJ,IAAAA,IAAI,EAAEC,MADD;AAELC,IAAAA,QAAQ,EAAE;AAFL,GATT;AAaEG,EAAAA,GAAG,EAAE;AACHL,IAAAA,IAAI,EAAEC,MADH;AAEHC,IAAAA,QAAQ,EAAE;AAFP;AAbP,CADgB,EAmBhB;AAAEI,EAAAA,UAAU,EAAE;AAAd,CAnBgB,CAAlB;AAsBAC,MAAM,CAACC,OAAP,GAAiBb,QAAQ,CAACc,KAAT,CAAe,KAAf,EAAsBX,SAAtB,CAAjB","sourceRoot":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/models/","sourcesContent":["'use strict';\nconst mongoose = require('mongoose');\nconst Schema = mongoose.Schema;\n\nconst skuSchema = new Schema(\n  {\n    sku: {\n      type: String,\n      required: true,\n    },\n    name: {\n      type: String,\n      required: true,\n    },\n    price: {\n      type: String,\n      required: true,\n    },\n    img: {\n      type: String,\n      required: true,\n    },\n  },\n  { timestamps: true }\n);\n\nmodule.exports = mongoose.model('SKU', skuSchema);\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"12fb460bde1848f59331c91966a3cc994e4e5b93","contentHash":"961ba7a2f344978451aa5fe8bd5a1f4e2232deb174b3ee1e52a05201de739d18"},"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/index.js":{"path":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/index.js","statementMap":{"0":{"start":{"line":3,"column":16},"end":{"line":3,"column":34}},"1":{"start":{"line":5,"column":13},"end":{"line":5,"column":28}},"2":{"start":{"line":7,"column":15},"end":{"line":7,"column":32}},"3":{"start":{"line":9,"column":17},"end":{"line":9,"column":39}},"4":{"start":{"line":11,"column":12},"end":{"line":11,"column":21}},"5":{"start":{"line":13,"column":0},"end":{"line":15,"column":3}},"6":{"start":{"line":14,"column":2},"end":{"line":14,"column":49}},"7":{"start":{"line":17,"column":18},"end":{"line":17,"column":41}},"8":{"start":{"line":19,"column":19},"end":{"line":19,"column":43}},"9":{"start":{"line":22,"column":0},"end":{"line":24,"column":4}},"10":{"start":{"line":26,"column":0},"end":{"line":26,"column":27}},"11":{"start":{"line":27,"column":0},"end":{"line":27,"column":16}},"12":{"start":{"line":28,"column":0},"end":{"line":28,"column":18}},"13":{"start":{"line":29,"column":0},"end":{"line":29,"column":30}},"14":{"start":{"line":30,"column":0},"end":{"line":30,"column":20}},"15":{"start":{"line":31,"column":0},"end":{"line":31,"column":21}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":13,"column":25},"end":{"line":13,"column":26}},"loc":{"start":{"line":13,"column":37},"end":{"line":15,"column":1}},"line":13}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":7,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1},"f":{"0":7},"b":{},"inputSourceMap":{"version":3,"sources":["index.js"],"names":["express","require","cors","helmet","bodyParser","app","Date","toISOString","apiRoutes","rootRoutes","use","urlencoded","extended","json","module","exports"],"mappings":"AAAA;;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AACA,MAAMC,IAAI,GAAGD,OAAO,CAAC,MAAD,CAApB;;AACA,MAAME,MAAM,GAAGF,OAAO,CAAC,QAAD,CAAtB;;AACA,IAAIG,UAAU,GAAGH,OAAO,CAAC,aAAD,CAAxB;;AAEA,MAAMI,GAAG,GAAGL,OAAO,EAAnB;;AAEAC,OAAO,CAAC,eAAD,CAAP,CAAyB,YAAY;AACnC,SAAO,MAAM,IAAIK,IAAJ,GAAWC,WAAX,EAAN,GAAiC,MAAxC;AACD,CAFD;;AAIA,MAAMC,SAAS,GAAGP,OAAO,CAAC,cAAD,CAAzB;;AACA,MAAMQ,UAAU,GAAGR,OAAO,CAAC,eAAD,CAA1B,C,CAEA;;;AACAI,GAAG,CAACK,GAAJ,CAAQN,UAAU,CAACO,UAAX,CAAsB;AAAEC,EAAAA,QAAQ,EAAE;AAAZ,CAAtB,CAAR,E,CAEA;;AACAP,GAAG,CAACK,GAAJ,CAAQN,UAAU,CAACS,IAAX,EAAR;AACAR,GAAG,CAACK,GAAJ,CAAQR,IAAI,EAAZ;AACAG,GAAG,CAACK,GAAJ,CAAQP,MAAM,EAAd;AACAE,GAAG,CAACK,GAAJ,CAAQ,SAAR,EAAmBF,SAAnB;AACAH,GAAG,CAACK,GAAJ,CAAQD,UAAR;AAEAK,MAAM,CAACC,OAAP,GAAiBV,GAAjB","sourceRoot":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/","sourcesContent":["'use strict';\nconst express = require('express');\nconst cors = require('cors');\nconst helmet = require('helmet');\nvar bodyParser = require('body-parser');\n\nconst app = express();\n\nrequire('log-timestamp')(function () {\n  return '[' + new Date().toISOString() + '] %s';\n});\n\nconst apiRoutes = require('./routes/api');\nconst rootRoutes = require('./routes/root');\n\n// parse application/x-www-form-urlencoded\napp.use(bodyParser.urlencoded({ extended: false }));\n\n// parse application/json\napp.use(bodyParser.json());\napp.use(cors());\napp.use(helmet());\napp.use('/api/v1', apiRoutes);\napp.use(rootRoutes);\n\nmodule.exports = app;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ed11a2c82c8ea7c464086e361f4d01e38054c41f","contentHash":"1d306f64dcbb96c607456abc79e8bbcf06259548140ce5edfcca35a64d2ebecc"},"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/routes/api.js":{"path":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/routes/api.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":3,"column":38}},"1":{"start":{"line":5,"column":16},"end":{"line":5,"column":34}},"2":{"start":{"line":7,"column":15},"end":{"line":7,"column":42}},"3":{"start":{"line":12,"column":4},"end":{"line":12,"column":29}},"4":{"start":{"line":14,"column":27},"end":{"line":14,"column":71}},"5":{"start":{"line":17,"column":15},"end":{"line":17,"column":31}},"6":{"start":{"line":25,"column":0},"end":{"line":36,"column":3}},"7":{"start":{"line":26,"column":2},"end":{"line":26,"column":37}},"8":{"start":{"line":28,"column":2},"end":{"line":35,"column":3}},"9":{"start":{"line":29,"column":21},"end":{"line":29,"column":68}},"10":{"start":{"line":30,"column":4},"end":{"line":30,"column":60}},"11":{"start":{"line":31,"column":4},"end":{"line":31,"column":107}},"12":{"start":{"line":33,"column":4},"end":{"line":33,"column":68}},"13":{"start":{"line":34,"column":4},"end":{"line":34,"column":112}},"14":{"start":{"line":44,"column":0},"end":{"line":54,"column":3}},"15":{"start":{"line":45,"column":2},"end":{"line":45,"column":36}},"16":{"start":{"line":47,"column":2},"end":{"line":53,"column":3}},"17":{"start":{"line":48,"column":18},"end":{"line":48,"column":52}},"18":{"start":{"line":49,"column":4},"end":{"line":49,"column":111}},"19":{"start":{"line":51,"column":4},"end":{"line":51,"column":52}},"20":{"start":{"line":52,"column":4},"end":{"line":52,"column":115}},"21":{"start":{"line":62,"column":0},"end":{"line":72,"column":3}},"22":{"start":{"line":63,"column":2},"end":{"line":63,"column":39}},"23":{"start":{"line":65,"column":2},"end":{"line":71,"column":3}},"24":{"start":{"line":66,"column":4},"end":{"line":66,"column":54}},"25":{"start":{"line":67,"column":4},"end":{"line":67,"column":112}},"26":{"start":{"line":69,"column":4},"end":{"line":69,"column":57}},"27":{"start":{"line":70,"column":4},"end":{"line":70,"column":112}},"28":{"start":{"line":73,"column":0},"end":{"line":73,"column":24}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":25,"column":25},"end":{"line":25,"column":26}},"loc":{"start":{"line":25,"column":54},"end":{"line":36,"column":1}},"line":25},"1":{"name":"(anonymous_1)","decl":{"start":{"line":44,"column":23},"end":{"line":44,"column":24}},"loc":{"start":{"line":44,"column":52},"end":{"line":54,"column":1}},"line":44},"2":{"name":"(anonymous_2)","decl":{"start":{"line":62,"column":27},"end":{"line":62,"column":28}},"loc":{"start":{"line":62,"column":56},"end":{"line":72,"column":1}},"line":62}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":4,"8":4,"9":4,"10":4,"11":4,"12":0,"13":0,"14":1,"15":1,"16":1,"17":1,"18":1,"19":0,"20":0,"21":1,"22":1,"23":1,"24":1,"25":1,"26":0,"27":0,"28":1},"f":{"0":4,"1":1,"2":1},"b":{},"inputSourceMap":{"version":3,"sources":["api.js"],"names":["express","require","logger","successResponse","errorResponse","skuPriceController","router","Router","post","request","response","info","totalprice","checkout","body","err","message","get","getSKUs","updateSKUs","module","exports"],"mappings":"AAAA;;;;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,kBAAD,CAAtB;;AACA,MAAM;AAAEE,EAAAA,eAAF;AAAmBC,EAAAA;AAAnB,IAAqCH,OAAO,CAAC,gBAAD,CAAlD;;AACA,MAAMI,kBAAkB,GAAGJ,OAAO,CAAC,mCAAD,CAAlC,C,CAEA;;;AACA,MAAMK,MAAM,GAAGN,OAAO,CAACO,MAAR,EAAf;AAEA;;;;;;;AAOAD,MAAM,CAACE,IAAP,CAAY,WAAZ,EAAyB,OAAOC,OAAP,EAAgBC,QAAhB,KAA6B;AACpDR,EAAAA,MAAM,CAACS,IAAP,CAAY,qBAAZ;;AACA,MAAI;AACF,QAAIC,UAAU,GAAG,MAAMP,kBAAkB,CAACQ,QAAnB,CAA4BJ,OAAO,CAACK,IAApC,CAAvB;AACAZ,IAAAA,MAAM,CAACS,IAAP,CAAY,0CAAZ;AACA,WAAOR,eAAe,CACpBO,QADoB,EAEpB,wDAFoB,EAGpBE,UAHoB,CAAtB;AAKD,GARD,CASA,OAAOG,GAAP,EAAY;AACVb,IAAAA,MAAM,CAACS,IAAP,CAAY,kDAAZ;AACA,WAAOP,aAAa,CAChBM,QADgB,mDAE0BK,GAAG,CAACC,OAF9B,YAGhB,GAHgB,CAApB;AAKD;AACF,CAnBD;AAqBA;;;;;;;AAOAV,MAAM,CAACW,GAAP,CAAW,UAAX,EAAuB,OAAOR,OAAP,EAAgBC,QAAhB,KAA6B;AAClDR,EAAAA,MAAM,CAACS,IAAP,CAAY,oBAAZ;;AACA,MAAI;AACF,QAAIO,OAAO,GAAG,MAAMb,kBAAkB,CAACa,OAAnB,EAApB;AACA,WAAOf,eAAe,CACpBO,QADoB,EAEpB,+DAFoB,EAGpBQ,OAHoB,CAAtB;AAKD,GAPD,CAQA,OAAOH,GAAP,EAAY;AACVb,IAAAA,MAAM,CAACS,IAAP,CAAY,kCAAZ;AACA,WAAOP,aAAa,CAChBM,QADgB,sDAE6BK,GAAG,CAACC,OAFjC,YAGhB,GAHgB,CAApB;AAKD;AACF,CAlBD;AAoBA;;;;;;;AAOAV,MAAM,CAACE,IAAP,CAAY,aAAZ,EAA2B,OAAOC,OAAP,EAAgBC,QAAhB,KAA6B;AACtDR,EAAAA,MAAM,CAACS,IAAP,CAAY,uBAAZ;;AACA,MAAI;AACF,UAAMN,kBAAkB,CAACc,UAAnB,CAA8BV,OAAO,CAACK,IAAtC,CAAN;AACA,WAAOX,eAAe,CACpBO,QADoB,EAEpB,mEAFoB,EAGpB,IAHoB,CAAtB;AAKD,GAPD,CAQA,OAAOK,GAAP,EAAY;AACVb,IAAAA,MAAM,CAACS,IAAP,CAAY,uCAAZ;AACA,WAAOP,aAAa,CAChBM,QADgB,mDAE0BK,GAAG,CAACC,OAF9B,YAGhB,GAHgB,CAApB;AAKD;AACF,CAlBD;AAmBAI,MAAM,CAACC,OAAP,GAAiBf,MAAjB","sourceRoot":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/routes/","sourcesContent":["'use strict';\nconst express = require('express');\nconst logger = require('../logger/logger');\nconst { successResponse, errorResponse } = require('../utils/utils');\nconst skuPriceController = require('../controllers/skupricecontroller');\n\n// eslint-disable-next-line new-cap\nconst router = express.Router();\n\n/**\n * Router POST call with '/checkout' endpoint.\n * @param {request} request from the client app\n * @param {response} response object for the client app\n * @return {response object}\n */\n\nrouter.post('/checkout', async (request, response) => {\n  logger.info('[+] In the checkout');\n  try {\n    let totalprice = await skuPriceController.checkout(request.body);\n    logger.info('[+] Total price calculated successfully.');\n    return successResponse(\n      response,\n      '<h1>The price is calculated by ECommerce service.</h1>',\n      totalprice\n    );\n  }\n  catch (err) {\n    logger.info('[+] Exception thrown in calculating total price.');\n    return errorResponse(\n        response,\n        `<h1>The schema validation error thrown ${err.message}</h1>`,\n        400\n      );\n  }  \n});\n\n/**\n * Router GET call with '/getSKUs' endpoint.\n * @param {request} request from the client app\n * @param {response} response object for the client app\n * @return {response object}\n */\n\nrouter.get('/getSKUs', async (request, response) => {\n  logger.info('[+] In the getSKUs');\n  try {\n    let getSKUs = await skuPriceController.getSKUs();\n    return successResponse(\n      response,\n      '<h1>The list of SKUs are retrieved by ECommerce service.</h1>',\n      getSKUs\n    );\n  }\n  catch (err) {\n    logger.info('[+] Exception thrown in get SKUs');\n    return errorResponse(\n        response,\n        `<h1>The retrieve SKUs API threw exception ${err.message}</h1>`,\n        500\n      );\n  }  \n});\n\n/**\n * Router POST call with '/updateSKUs' endpoint.\n * @param {request} request from the client app\n * @param {response} response object for the client app\n * @return {response object}\n */\n\nrouter.post('/updateSKUs', async (request, response) => {\n  logger.info('[+] In the updateSKUs');\n  try {\n    await skuPriceController.updateSKUs(request.body);\n    return successResponse(\n      response,\n      '<h1>The given SKU(s) updated by ECommerce service in its DB.</h1>',\n      'OK'\n    );\n  }\n  catch (err) {\n    logger.info('[+] Exception thrown in updating SKUs');\n    return errorResponse(\n        response,\n        `<h1>The schema validation error thrown ${err.message}</h1>`,\n        400\n      );\n  }  \n});\nmodule.exports = router;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"828137a7e7a5704e2370e7d5fc1088c51996c87d","contentHash":"a830c4840e4895af98a73bbec6fabcf67b9b68d46fcf6266f6233644cf9ba99a"},"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/controllers/skupricecontroller.js":{"path":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/controllers/skupricecontroller.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":3,"column":38}},"1":{"start":{"line":5,"column":17},"end":{"line":5,"column":50}},"2":{"start":{"line":7,"column":21},"end":{"line":7,"column":58}},"3":{"start":{"line":9,"column":15},"end":{"line":9,"column":42}},"4":{"start":{"line":14,"column":4},"end":{"line":14,"column":29}},"5":{"start":{"line":19,"column":4},"end":{"line":19,"column":31}},"6":{"start":{"line":21,"column":12},"end":{"line":21,"column":26}},"7":{"start":{"line":23,"column":12},"end":{"line":23,"column":21}},"8":{"start":{"line":30,"column":0},"end":{"line":53,"column":2}},"9":{"start":{"line":31,"column":2},"end":{"line":31,"column":76}},"10":{"start":{"line":33,"column":2},"end":{"line":52,"column":3}},"11":{"start":{"line":34,"column":19},"end":{"line":34,"column":54}},"12":{"start":{"line":35,"column":4},"end":{"line":35,"column":67}},"13":{"start":{"line":37,"column":4},"end":{"line":48,"column":5}},"14":{"start":{"line":38,"column":19},"end":{"line":38,"column":34}},"15":{"start":{"line":39,"column":27},"end":{"line":39,"column":49}},"16":{"start":{"line":40,"column":23},"end":{"line":40,"column":49}},"17":{"start":{"line":41,"column":6},"end":{"line":43,"column":9}},"18":{"start":{"line":42,"column":8},"end":{"line":42,"column":28}},"19":{"start":{"line":44,"column":6},"end":{"line":44,"column":30}},"20":{"start":{"line":47,"column":6},"end":{"line":47,"column":47}},"21":{"start":{"line":51,"column":4},"end":{"line":51,"column":21}},"22":{"start":{"line":61,"column":0},"end":{"line":80,"column":2}},"23":{"start":{"line":62,"column":2},"end":{"line":62,"column":43}},"24":{"start":{"line":64,"column":2},"end":{"line":79,"column":3}},"25":{"start":{"line":65,"column":19},"end":{"line":65,"column":34}},"26":{"start":{"line":66,"column":15},"end":{"line":66,"column":17}},"27":{"start":{"line":67,"column":4},"end":{"line":74,"column":7}},"28":{"start":{"line":68,"column":16},"end":{"line":68,"column":18}},"29":{"start":{"line":69,"column":6},"end":{"line":69,"column":25}},"30":{"start":{"line":70,"column":6},"end":{"line":70,"column":27}},"31":{"start":{"line":71,"column":6},"end":{"line":71,"column":29}},"32":{"start":{"line":72,"column":6},"end":{"line":72,"column":25}},"33":{"start":{"line":73,"column":6},"end":{"line":73,"column":21}},"34":{"start":{"line":75,"column":4},"end":{"line":75,"column":16}},"35":{"start":{"line":78,"column":4},"end":{"line":78,"column":21}},"36":{"start":{"line":88,"column":0},"end":{"line":105,"column":2}},"37":{"start":{"line":89,"column":2},"end":{"line":89,"column":43}},"38":{"start":{"line":91,"column":2},"end":{"line":104,"column":3}},"39":{"start":{"line":92,"column":19},"end":{"line":92,"column":55}},"40":{"start":{"line":93,"column":4},"end":{"line":93,"column":67}},"41":{"start":{"line":95,"column":4},"end":{"line":100,"column":5}},"42":{"start":{"line":96,"column":6},"end":{"line":96,"column":30}},"43":{"start":{"line":99,"column":6},"end":{"line":99,"column":47}},"44":{"start":{"line":103,"column":4},"end":{"line":103,"column":21}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":30,"column":19},"end":{"line":30,"column":20}},"loc":{"start":{"line":30,"column":34},"end":{"line":53,"column":1}},"line":30},"1":{"name":"(anonymous_1)","decl":{"start":{"line":41,"column":20},"end":{"line":41,"column":21}},"loc":{"start":{"line":41,"column":28},"end":{"line":43,"column":7}},"line":41},"2":{"name":"(anonymous_2)","decl":{"start":{"line":61,"column":18},"end":{"line":61,"column":19}},"loc":{"start":{"line":61,"column":30},"end":{"line":80,"column":1}},"line":61},"3":{"name":"(anonymous_3)","decl":{"start":{"line":67,"column":19},"end":{"line":67,"column":20}},"loc":{"start":{"line":67,"column":33},"end":{"line":74,"column":5}},"line":67},"4":{"name":"(anonymous_4)","decl":{"start":{"line":88,"column":21},"end":{"line":88,"column":22}},"loc":{"start":{"line":88,"column":36},"end":{"line":105,"column":1}},"line":88}},"branchMap":{"0":{"loc":{"start":{"line":37,"column":4},"end":{"line":48,"column":5}},"type":"if","locations":[{"start":{"line":37,"column":4},"end":{"line":48,"column":5}},{"start":{"line":37,"column":4},"end":{"line":48,"column":5}}],"line":37},"1":{"loc":{"start":{"line":95,"column":4},"end":{"line":100,"column":5}},"type":"if","locations":[{"start":{"line":95,"column":4},"end":{"line":100,"column":5}},{"start":{"line":95,"column":4},"end":{"line":100,"column":5}}],"line":95}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":4,"10":4,"11":4,"12":4,"13":4,"14":4,"15":4,"16":4,"17":4,"18":9,"19":4,"20":0,"21":0,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":4,"29":4,"30":4,"31":4,"32":4,"33":4,"34":1,"35":0,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":0,"44":0},"f":{"0":4,"1":9,"2":1,"3":4,"4":1},"b":{"0":[4,0],"1":[1,0]},"inputSourceMap":{"version":3,"sources":["skupricecontroller.js"],"names":["Checkout","require","PricingRules","logger","getSKUs","upsertSKUs","checkoutSchema","updateSKUSchema","Ajv","ajv","exports","checkout","items","info","length","result","validate","skus","pricingRules","forEach","item","scan","total","Error","err","skusDB","data","sku","name","price","img","push","updateSKUs"],"mappings":"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","sourceRoot":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/controllers/","sourcesContent":["'use strict';\nconst Checkout = require('../components/checkout');\nconst PricingRules = require('../components/pricingrules');\nconst logger = require('../logger/logger');\nconst { getSKUs, upsertSKUs } = require('../utils/utils');\nconst { checkoutSchema, updateSKUSchema } = require('../models/schema');\nconst Ajv = require('ajv');\nconst ajv = new Ajv();\n\n/**\n * Retrieve the total price at checkout token from the given service.\n * @param {items} items of the remote service\n * @return {total of the checkedout cart}\n */\n\nexports.checkout = async (items) => {\n  logger.info(`[+] Total number of items checkedout ${items.length}`);\n  try {\n    const result = ajv.validate(checkoutSchema, items);\n    logger.info(`[+] Schema validation result is ${result}`);\n    if(result) {\n      const skus = await getSKUs();\n      const pricingRules = new PricingRules(skus);\n      const checkout = new Checkout(pricingRules);\n      items.forEach((item) => {\n        checkout.scan(item);\n      });\n      return checkout.total();\n    } else {\n      // Throw error to catch at the called method to send proper error response.\n      throw Error(\"schema validation failed!\");\n    }\n  }\n  catch (err)\n  {\n      // Throw error to catch at the called method to send proper error response.\n      throw Error(err);\n  }\n};\n\n/**\n * Retrieve the list of all SKUs from the given DB.\n * @param {url} URL of the remote service\n * @return {skus}\n */\n\nexports.getSKUs = async () => {\n  logger.info('[+] Retrieve list of SKUs');\n  try {\n    const skusDB = await getSKUs();\n    let skus = [];\n    skusDB.forEach(async (data) => {\n      let sku = {}\n      sku.sku = data.sku;\n      sku.name = data.name;\n      sku.price = data.price;\n      sku.img = data.img;\n      skus.push(sku);\n    });\n    return skus;\n  }\n  catch (err)\n  {\n      // Throw error to catch at the called method to send proper error response.\n      throw Error(err);\n  }\n};\n\n/**\n * Insert/Update the SKU(s) from the given DB.\n * @param {url} URL of the remote service\n * @return {response data}\n */\n\nexports.updateSKUs = async (items) => {\n  logger.info('[+] Retrieve list of SKUs');\n  try {\n    const result = ajv.validate(updateSKUSchema, items);\n    logger.info(`[+] Schema validation result is ${result}`);\n    if(result) {\n      await upsertSKUs(items);\n    } else {\n      // Throw error to catch at the called method to send proper error response.\n      throw Error(\"schema validation failed!\");\n    }\n  }\n  catch (err)\n  {\n      // Throw error to catch at the called method to send proper error response.\n      throw Error(err);\n  }\n};"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"867d8cb0865e1d835222d6ae378f2d6890fb8522","contentHash":"cf7b2a42330c5d20d605e272be5bbf7083e1e918a2a96de01569c2e191af8429"},"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/components/checkout.js":{"path":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/components/checkout.js","statementMap":{"0":{"start":{"line":13,"column":4},"end":{"line":13,"column":28}},"1":{"start":{"line":14,"column":4},"end":{"line":14,"column":37}},"2":{"start":{"line":24,"column":4},"end":{"line":24,"column":34}},"3":{"start":{"line":25,"column":4},"end":{"line":25,"column":11}},"4":{"start":{"line":34,"column":4},"end":{"line":38,"column":5}},"5":{"start":{"line":35,"column":6},"end":{"line":35,"column":66}},"6":{"start":{"line":37,"column":6},"end":{"line":37,"column":16}},"7":{"start":{"line":43,"column":0},"end":{"line":47,"column":1}},"8":{"start":{"line":44,"column":2},"end":{"line":44,"column":28}},"9":{"start":{"line":46,"column":2},"end":{"line":46,"column":29}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":12,"column":2},"end":{"line":12,"column":3}},"loc":{"start":{"line":12,"column":28},"end":{"line":15,"column":3}},"line":12},"1":{"name":"(anonymous_1)","decl":{"start":{"line":23,"column":2},"end":{"line":23,"column":3}},"loc":{"start":{"line":23,"column":13},"end":{"line":26,"column":3}},"line":23},"2":{"name":"(anonymous_2)","decl":{"start":{"line":33,"column":2},"end":{"line":33,"column":3}},"loc":{"start":{"line":33,"column":10},"end":{"line":39,"column":3}},"line":33}},"branchMap":{"0":{"loc":{"start":{"line":34,"column":4},"end":{"line":38,"column":5}},"type":"if","locations":[{"start":{"line":34,"column":4},"end":{"line":38,"column":5}},{"start":{"line":34,"column":4},"end":{"line":38,"column":5}}],"line":34},"1":{"loc":{"start":{"line":43,"column":0},"end":{"line":47,"column":1}},"type":"if","locations":[{"start":{"line":43,"column":0},"end":{"line":47,"column":1}},{"start":{"line":43,"column":0},"end":{"line":47,"column":1}}],"line":43},"2":{"loc":{"start":{"line":43,"column":4},"end":{"line":43,"column":74}},"type":"binary-expr","locations":[{"start":{"line":43,"column":4},"end":{"line":43,"column":33}},{"start":{"line":43,"column":37},"end":{"line":43,"column":74}}],"line":43}},"s":{"0":4,"1":4,"2":9,"3":9,"4":4,"5":4,"6":0,"7":1,"8":1,"9":0},"f":{"0":4,"1":9,"2":4},"b":{"0":[4,0],"1":[1,0],"2":[1,1]},"inputSourceMap":{"version":3,"sources":["checkout.js"],"names":["Checkout","constructor","pricingRules","checkoutItems","scan","item","push","total","calculateTotal","module","exports","window"],"mappings":"AAAA;AAEA;;;;AAGA,MAAMA,QAAN,CAAe;AACb;;;;;AAKAC,EAAAA,WAAW,CAACC,YAAD,EAAe;AACxB,SAAKC,aAAL,GAAqB,EAArB;AACA,SAAKD,YAAL,GAAoBA,YAApB;AACD;AAED;;;;;;;AAKAE,EAAAA,IAAI,CAACC,IAAD,EAAO;AACT,SAAKF,aAAL,CAAmBG,IAAnB,CAAwBD,IAAxB;AACA;AACD;AAED;;;;;;AAIAE,EAAAA,KAAK,GAAG;AACN,QAAI,KAAKL,YAAT,EAAuB;AACrB,aAAO,KAAKA,YAAL,CAAkBM,cAAlB,CAAiC,KAAKL,aAAtC,CAAP;AACD,KAFD,MAEO;AACL,aAAO,CAAC,CAAR;AACD;AACF;;AA/BY;;AAkCf,IAAI,OAAOM,MAAP,KAAkB,WAAlB,IAAiC,OAAOA,MAAM,CAACC,OAAd,KAA0B,WAA/D,EAA4E;AAC1ED,EAAAA,MAAM,CAACC,OAAP,GAAiBV,QAAjB;AACD,CAFD,MAEO;AACLW,EAAAA,MAAM,CAACX,QAAP,GAAkBA,QAAlB;AACD","sourceRoot":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/components/","sourcesContent":["'use strict';\n\n/**\n * Represents Checkout process and uses pricingRules.\n */\nclass Checkout {\n  /**\n   * Represents Checkout process.\n   * @constructor\n   * @param {list} pricingRules rules to be used\n   */\n  constructor(pricingRules) {\n    this.checkoutItems = [];\n    this.pricingRules = pricingRules;\n  }\n\n  /**\n   * Item of which price to be added in the list\n   * @param {item} item of scanned items\n   * @return {number} price\n   */\n  scan(item) {\n    this.checkoutItems.push(item);\n    return;\n  }\n\n  /**\n   * Total of which price to be added in the list\n   * @return {number} price\n   */\n  total() {\n    if (this.pricingRules) {\n      return this.pricingRules.calculateTotal(this.checkoutItems);\n    } else {\n      return -1;\n    }\n  }\n}\n\nif (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n  module.exports = Checkout;\n} else {\n  window.Checkout = Checkout;\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"0891620d402193f0205289a2e36781604d93b715","contentHash":"6de1ddcd0b1a8769cd1be93447444c3978233cfb141350d62fac709adafd33d4"},"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/components/pricingrules.js":{"path":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/components/pricingrules.js","statementMap":{"0":{"start":{"line":3,"column":15},"end":{"line":3,"column":42}},"1":{"start":{"line":16,"column":4},"end":{"line":18,"column":5}},"2":{"start":{"line":17,"column":6},"end":{"line":17,"column":70}},"3":{"start":{"line":20,"column":4},"end":{"line":22,"column":7}},"4":{"start":{"line":21,"column":6},"end":{"line":21,"column":142}},"5":{"start":{"line":23,"column":4},"end":{"line":23,"column":25}},"6":{"start":{"line":24,"column":4},"end":{"line":24,"column":94}},"7":{"start":{"line":34,"column":4},"end":{"line":34,"column":94}},"8":{"start":{"line":38,"column":25},"end":{"line":38,"column":26}},"9":{"start":{"line":39,"column":20},"end":{"line":39,"column":21}},"10":{"start":{"line":40,"column":20},"end":{"line":40,"column":21}},"11":{"start":{"line":41,"column":4},"end":{"line":47,"column":7}},"12":{"start":{"line":42,"column":6},"end":{"line":46,"column":7}},"13":{"start":{"line":43,"column":8},"end":{"line":43,"column":32}},"14":{"start":{"line":44,"column":13},"end":{"line":46,"column":7}},"15":{"start":{"line":45,"column":8},"end":{"line":45,"column":32}},"16":{"start":{"line":49,"column":4},"end":{"line":55,"column":5}},"17":{"start":{"line":50,"column":6},"end":{"line":50,"column":29}},"18":{"start":{"line":52,"column":6},"end":{"line":54,"column":7}},"19":{"start":{"line":53,"column":8},"end":{"line":53,"column":22}},"20":{"start":{"line":57,"column":4},"end":{"line":81,"column":7}},"21":{"start":{"line":58,"column":6},"end":{"line":80,"column":7}},"22":{"start":{"line":59,"column":26},"end":{"line":59,"column":37}},"23":{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},"24":{"start":{"line":62,"column":10},"end":{"line":62,"column":27}},"25":{"start":{"line":65,"column":8},"end":{"line":65,"column":69}},"26":{"start":{"line":66,"column":13},"end":{"line":80,"column":7}},"27":{"start":{"line":67,"column":24},"end":{"line":67,"column":52}},"28":{"start":{"line":69,"column":8},"end":{"line":71,"column":9}},"29":{"start":{"line":70,"column":10},"end":{"line":70,"column":29}},"30":{"start":{"line":73,"column":8},"end":{"line":73,"column":50}},"31":{"start":{"line":74,"column":13},"end":{"line":80,"column":7}},"32":{"start":{"line":75,"column":24},"end":{"line":75,"column":52}},"33":{"start":{"line":76,"column":8},"end":{"line":76,"column":50}},"34":{"start":{"line":77,"column":13},"end":{"line":80,"column":7}},"35":{"start":{"line":78,"column":24},"end":{"line":78,"column":52}},"36":{"start":{"line":79,"column":8},"end":{"line":79,"column":48}},"37":{"start":{"line":82,"column":4},"end":{"line":82,"column":26}},"38":{"start":{"line":92,"column":4},"end":{"line":98,"column":5}},"39":{"start":{"line":92,"column":17},"end":{"line":92,"column":18}},"40":{"start":{"line":93,"column":20},"end":{"line":93,"column":36}},"41":{"start":{"line":95,"column":6},"end":{"line":97,"column":7}},"42":{"start":{"line":96,"column":8},"end":{"line":96,"column":29}},"43":{"start":{"line":100,"column":4},"end":{"line":100,"column":14}},"44":{"start":{"line":105,"column":0},"end":{"line":109,"column":1}},"45":{"start":{"line":106,"column":2},"end":{"line":106,"column":32}},"46":{"start":{"line":108,"column":2},"end":{"line":108,"column":37}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":15,"column":2},"end":{"line":15,"column":3}},"loc":{"start":{"line":15,"column":20},"end":{"line":25,"column":3}},"line":15},"1":{"name":"(anonymous_1)","decl":{"start":{"line":20,"column":17},"end":{"line":20,"column":18}},"loc":{"start":{"line":20,"column":25},"end":{"line":22,"column":5}},"line":20},"2":{"name":"(anonymous_2)","decl":{"start":{"line":33,"column":2},"end":{"line":33,"column":3}},"loc":{"start":{"line":33,"column":24},"end":{"line":83,"column":3}},"line":33},"3":{"name":"(anonymous_3)","decl":{"start":{"line":41,"column":18},"end":{"line":41,"column":19}},"loc":{"start":{"line":41,"column":26},"end":{"line":47,"column":5}},"line":41},"4":{"name":"(anonymous_4)","decl":{"start":{"line":57,"column":18},"end":{"line":57,"column":19}},"loc":{"start":{"line":57,"column":26},"end":{"line":81,"column":5}},"line":57},"5":{"name":"(anonymous_5)","decl":{"start":{"line":91,"column":2},"end":{"line":91,"column":3}},"loc":{"start":{"line":91,"column":21},"end":{"line":101,"column":3}},"line":91}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":4},"end":{"line":18,"column":5}},"type":"if","locations":[{"start":{"line":16,"column":4},"end":{"line":18,"column":5}},{"start":{"line":16,"column":4},"end":{"line":18,"column":5}}],"line":16},"1":{"loc":{"start":{"line":42,"column":6},"end":{"line":46,"column":7}},"type":"if","locations":[{"start":{"line":42,"column":6},"end":{"line":46,"column":7}},{"start":{"line":42,"column":6},"end":{"line":46,"column":7}}],"line":42},"2":{"loc":{"start":{"line":44,"column":13},"end":{"line":46,"column":7}},"type":"if","locations":[{"start":{"line":44,"column":13},"end":{"line":46,"column":7}},{"start":{"line":44,"column":13},"end":{"line":46,"column":7}}],"line":44},"3":{"loc":{"start":{"line":49,"column":4},"end":{"line":55,"column":5}},"type":"if","locations":[{"start":{"line":49,"column":4},"end":{"line":55,"column":5}},{"start":{"line":49,"column":4},"end":{"line":55,"column":5}}],"line":49},"4":{"loc":{"start":{"line":52,"column":6},"end":{"line":54,"column":7}},"type":"if","locations":[{"start":{"line":52,"column":6},"end":{"line":54,"column":7}},{"start":{"line":52,"column":6},"end":{"line":54,"column":7}}],"line":52},"5":{"loc":{"start":{"line":58,"column":6},"end":{"line":80,"column":7}},"type":"if","locations":[{"start":{"line":58,"column":6},"end":{"line":80,"column":7}},{"start":{"line":58,"column":6},"end":{"line":80,"column":7}}],"line":58},"6":{"loc":{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},"type":"if","locations":[{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},{"start":{"line":61,"column":8},"end":{"line":63,"column":9}}],"line":61},"7":{"loc":{"start":{"line":66,"column":13},"end":{"line":80,"column":7}},"type":"if","locations":[{"start":{"line":66,"column":13},"end":{"line":80,"column":7}},{"start":{"line":66,"column":13},"end":{"line":80,"column":7}}],"line":66},"8":{"loc":{"start":{"line":69,"column":8},"end":{"line":71,"column":9}},"type":"if","locations":[{"start":{"line":69,"column":8},"end":{"line":71,"column":9}},{"start":{"line":69,"column":8},"end":{"line":71,"column":9}}],"line":69},"9":{"loc":{"start":{"line":74,"column":13},"end":{"line":80,"column":7}},"type":"if","locations":[{"start":{"line":74,"column":13},"end":{"line":80,"column":7}},{"start":{"line":74,"column":13},"end":{"line":80,"column":7}}],"line":74},"10":{"loc":{"start":{"line":77,"column":13},"end":{"line":80,"column":7}},"type":"if","locations":[{"start":{"line":77,"column":13},"end":{"line":80,"column":7}},{"start":{"line":77,"column":13},"end":{"line":80,"column":7}}],"line":77},"11":{"loc":{"start":{"line":95,"column":6},"end":{"line":97,"column":7}},"type":"if","locations":[{"start":{"line":95,"column":6},"end":{"line":97,"column":7}},{"start":{"line":95,"column":6},"end":{"line":97,"column":7}}],"line":95},"12":{"loc":{"start":{"line":105,"column":0},"end":{"line":109,"column":1}},"type":"if","locations":[{"start":{"line":105,"column":0},"end":{"line":109,"column":1}},{"start":{"line":105,"column":0},"end":{"line":109,"column":1}}],"line":105},"13":{"loc":{"start":{"line":105,"column":4},"end":{"line":105,"column":74}},"type":"binary-expr","locations":[{"start":{"line":105,"column":4},"end":{"line":105,"column":33}},{"start":{"line":105,"column":37},"end":{"line":105,"column":74}}],"line":105}},"s":{"0":1,"1":4,"2":0,"3":4,"4":16,"5":4,"6":4,"7":4,"8":4,"9":4,"10":4,"11":4,"12":9,"13":2,"14":7,"15":2,"16":4,"17":2,"18":2,"19":1,"20":4,"21":9,"22":3,"23":3,"24":1,"25":3,"26":6,"27":2,"28":2,"29":1,"30":2,"31":4,"32":2,"33":2,"34":2,"35":2,"36":2,"37":4,"38":9,"39":9,"40":19,"41":19,"42":9,"43":0,"44":1,"45":1,"46":0},"f":{"0":4,"1":16,"2":4,"3":9,"4":9,"5":9},"b":{"0":[0,4],"1":[2,7],"2":[2,5],"3":[2,2],"4":[1,1],"5":[3,6],"6":[1,2],"7":[2,4],"8":[1,1],"9":[2,2],"10":[2,0],"11":[9,10],"12":[1,0],"13":[1,1]},"inputSourceMap":{"version":3,"sources":["pricingrules.js"],"names":["logger","require","PricingRules","constructor","skus","error","forEach","data","info","sku","name","price","img","products","length","calculateTotal","items","vgaNumber","mbpNumber","item","number","itemToPrice","getPriceOfSKU","itemPrice","i","product","module","exports","window"],"mappings":"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","sourceRoot":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/components/","sourcesContent":["'use strict';\nconst logger = require('../logger/logger');\n\n/**\n * Represents Pricing Rules applicable for calculating total price\n */\nclass PricingRules {\n  /**\n   * Represents PricingRules.\n   * @constructor\n   * @param {list} skus list of skus from MongoDB\n   */\n  constructor(skus) {\n    if (!skus) {\n      logger.error('[+] getSKUs -- error getting skus from mongoDB!');\n    }\n    skus.forEach((data) => {\n      logger.info(`[+] ECommerce service has ${data.sku}, ${data.name}, ${data.price}, ${data.img}.`);\n    });\n    this.products = skus;\n    logger.info(`[+] Total number of products in pricingRules ${this.products.length}`);\n  }\n\n  /**\n   * Item of which price to be calculated\n   * @param {list} items of scanned items\n   * @return {number} price\n   */\n  calculateTotal(items) {\n    logger.info(`[+] Total number of checkedout items in pricingRules ${items.length}`);\n\n    // 1. We're going to have a 3 for 2 deal on Apple TVs. For example, if you buy 3 Apple TVs, you will pay the price of 2 only\n    // 2. The brand new Super iPad will have a bulk discounted applied, where the price will drop to $499.99 each, if someone buys more than 4\n    // 3. We will bundle in a free VGA adapter free of charge with every MacBook Pro sold\n    let calculateTotal = 0;\n    let vgaNumber = 0,\n      mbpNumber = 0;\n    items.forEach((item) => {\n      if (item.sku === 'vga') {\n        vgaNumber = item.number;\n      } else if (item.sku === 'mbp') {\n        mbpNumber = item.number;\n      }\n    });\n    if (mbpNumber > 0) {\n      vgaNumber -= mbpNumber;\n      if (vgaNumber < 0) {\n        vgaNumber = 0;\n      }\n    }\n    items.forEach((item) => {\n      if (item.sku === 'atv') {\n        let itemToPrice = item.number;\n        if (item.number >= 3) {\n          itemToPrice -= 1;\n        }\n        calculateTotal += this.getPriceOfSKU(item.sku) * itemToPrice;\n      } else if (item.sku === 'ipd') {\n        let itemPrice = this.getPriceOfSKU(item.sku);\n        if (item.number > 4) {\n          itemPrice = 499.99;\n        }\n        calculateTotal += itemPrice * item.number;\n      } else if (item.sku === 'mbp') {\n        let itemPrice = this.getPriceOfSKU(item.sku);\n        calculateTotal += itemPrice * item.number;\n      } else if (item.sku === 'vga') {\n        let itemPrice = this.getPriceOfSKU(item.sku);\n        calculateTotal += itemPrice * vgaNumber;\n      }\n    });\n    return calculateTotal;\n  }\n\n  /**\n   * Item of which price to be calculated\n   * @param {item} sku item\n   * @return {number} price\n   */\n  getPriceOfSKU(sku) {\n    for (let i = 0; i < this.products.length; i++) {\n      let product = this.products[i];\n      if (product.sku === sku) {\n        return product.price;\n      }\n    }\n    return -1;\n  }\n}\n\nif (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n  module.exports = PricingRules;\n} else {\n  window.PricingRules = PricingRules;\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b6d0df8043aa8af4e4b555bb8c89b474ecd36a28","contentHash":"cba3599a5f9611083a3b59c3e0f02f72009fe5a67320ec9f5f17ea4634e4adfd"},"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/models/schema.js":{"path":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/models/schema.js","statementMap":{"0":{"start":{"line":3,"column":23},"end":{"line":25,"column":1}},"1":{"start":{"line":26,"column":24},"end":{"line":48,"column":1}},"2":{"start":{"line":49,"column":0},"end":{"line":49,"column":40}},"3":{"start":{"line":50,"column":0},"end":{"line":50,"column":42}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1},"f":{},"b":{},"inputSourceMap":{"version":3,"sources":["schema.js"],"names":["checkoutSchema","updateSKUSchema","exports"],"mappings":";;AAAA,MAAMA,cAAc,GAAI;AACpB,WAAS;AACL,gBAAY,CACR,KADQ,EAER,QAFQ,CADP;AAKL,kBAAc;AACV,aAAO;AACH,eAAO,wBADJ;AAEH,gBAAQ,QAFL;AAGH,mBAAY,KAHT;AAIH,gBAAQ,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,EAAsB,KAAtB;AAJL,OADG;AAOV,gBAAU;AACN,eAAO,2BADD;AAEN,gBAAQ;AAFF;AAPA,KALT;AAiBL,WAAO,SAjBF;AAkBL,YAAQ;AAlBH,GADW;AAqBpB,SAAO,mCArBa;AAsBpB,UAAQ,OAtBY;AAuBpB,iBAAe,EAvBK;AAwBpB,aAAW;AAxBS,CAAxB;AA2BA,MAAMC,eAAe,GAAI;AACrB,WAAS;AACL,gBAAY,CACR,KADQ,EAER,OAFQ,CADP;AAKL,kBAAc;AACV,aAAO;AACH,eAAO,wBADJ;AAEH,gBAAQ,QAFL;AAGH,mBAAY,KAHT;AAIH,gBAAQ,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,EAAsB,KAAtB;AAJL,OADG;AAOV,eAAS;AACL,eAAO,0BADF;AAEL,gBAAQ;AAFH;AAPC,KALT;AAiBL,WAAO,SAjBF;AAkBL,YAAQ;AAlBH,GADY;AAqBrB,SAAO,oCArBc;AAsBrB,UAAQ,OAtBa;AAuBrB,iBAAe,EAvBM;AAwBrB,aAAW;AAxBU,CAAzB;AA2BAC,OAAO,CAACF,cAAR,GAAyBA,cAAzB;AACAE,OAAO,CAACD,eAAR,GAA0BA,eAA1B","sourceRoot":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/models/","sourcesContent":["const checkoutSchema =  {\n    \"items\": {\n        \"required\": [\n            \"sku\",\n            \"number\"\n        ],\n        \"properties\": {\n            \"sku\": {\n                \"$id\": \"#/items/properties/sku\",\n                \"type\": \"string\",\n                \"default\" : \"mbp\",\n                \"enum\": [\"ipd\", \"mbp\", \"atv\", \"vga\"]\n            },\n            \"number\": {\n                \"$id\": \"#/items/properties/number\",\n                \"type\": \"integer\"\n            }\n        },\n        \"$id\": \"#/items\",\n        \"type\": \"object\"\n    },\n    \"$id\": \"http://example.org/checkout.json#\",\n    \"type\": \"array\",\n    \"definitions\": {},\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\"\n};\n\nconst updateSKUSchema =  {\n    \"items\": {\n        \"required\": [\n            \"sku\",\n            \"price\"\n        ],\n        \"properties\": {\n            \"sku\": {\n                \"$id\": \"#/items/properties/sku\",\n                \"type\": \"string\",\n                \"default\" : \"mbp\",\n                \"enum\": [\"ipd\", \"mbp\", \"atv\", \"vga\"]\n            },\n            \"price\": {\n                \"$id\": \"#/items/properties/price\",\n                \"type\": \"number\"\n            }\n        },\n        \"$id\": \"#/items\",\n        \"type\": \"object\"\n    },\n    \"$id\": \"http://example.org/updatesku.json#\",\n    \"type\": \"array\",\n    \"definitions\": {},\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\"\n};\n\nexports.checkoutSchema = checkoutSchema;\nexports.updateSKUSchema = updateSKUSchema;"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9d11b4ae86a8626e587ed534b1ca51f462d2e2ba","contentHash":"d0c65eed6811e0a27d3f243c86a77a632b9da95e7f28583c19691aae09f56609"},"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/routes/root.js":{"path":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/routes/root.js","statementMap":{"0":{"start":{"line":3,"column":16},"end":{"line":3,"column":34}},"1":{"start":{"line":5,"column":15},"end":{"line":5,"column":42}},"2":{"start":{"line":9,"column":4},"end":{"line":9,"column":29}},"3":{"start":{"line":12,"column":15},"end":{"line":12,"column":31}},"4":{"start":{"line":20,"column":0},"end":{"line":23,"column":3}},"5":{"start":{"line":21,"column":2},"end":{"line":21,"column":33}},"6":{"start":{"line":22,"column":2},"end":{"line":22,"column":83}},"7":{"start":{"line":31,"column":0},"end":{"line":34,"column":3}},"8":{"start":{"line":32,"column":2},"end":{"line":32,"column":33}},"9":{"start":{"line":33,"column":2},"end":{"line":33,"column":81}},"10":{"start":{"line":35,"column":0},"end":{"line":35,"column":24}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":20,"column":16},"end":{"line":20,"column":17}},"loc":{"start":{"line":20,"column":39},"end":{"line":23,"column":1}},"line":20},"1":{"name":"(anonymous_1)","decl":{"start":{"line":31,"column":20},"end":{"line":31,"column":21}},"loc":{"start":{"line":31,"column":43},"end":{"line":34,"column":1}},"line":31}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1},"f":{"0":1,"1":1},"b":{},"inputSourceMap":{"version":3,"sources":["root.js"],"names":["express","require","logger","successResponse","router","Router","get","request","response","info","module","exports"],"mappings":"AAAA;;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,kBAAD,CAAtB;;AACA,IAAI;AAAEE,EAAAA;AAAF,IAAsBF,OAAO,CAAC,gBAAD,CAAjC,C,CAEA;;;AACA,MAAMG,MAAM,GAAGJ,OAAO,CAACK,MAAR,EAAf;AAEA;;;;;;;AAOAD,MAAM,CAACE,GAAP,CAAW,GAAX,EAAgB,CAACC,OAAD,EAAUC,QAAV,KAAuB;AACrCN,EAAAA,MAAM,CAACO,IAAP,CAAY,iBAAZ;AACA,SAAON,eAAe,CAACK,QAAD,EAAW,wCAAX,EAAoD,IAApD,CAAtB;AACD,CAHD;AAKA;;;;;;;AAOAJ,MAAM,CAACE,GAAP,CAAW,OAAX,EAAoB,CAACC,OAAD,EAAUC,QAAV,KAAuB;AACzCN,EAAAA,MAAM,CAACO,IAAP,CAAY,iBAAZ;AACA,SAAON,eAAe,CAACK,QAAD,EAAW,sCAAX,EAAkD,IAAlD,CAAtB;AACD,CAHD;AAKAE,MAAM,CAACC,OAAP,GAAiBP,MAAjB","sourceRoot":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/routes/","sourcesContent":["'use strict';\nconst express = require('express');\nconst logger = require('../logger/logger');\nvar { successResponse } = require('../utils/utils');\n\n// eslint-disable-next-line new-cap\nconst router = express.Router();\n\n/**\n * Router GET call with '/' endpoint.\n * @param {request} request from the client app\n * @param {response} response object for the client app\n * @return {response object}\n */\n\nrouter.get('/', (request, response) => {\n  logger.info('[+] In the root');\n  return successResponse(response, '<h1>Hello from ECommerce Service!</h1>','OK');\n});\n\n/**\n * Router GET call with '/ping' endpoint.\n * @param {request} request from the client app\n * @param {response} response object for the client app\n * @return {response object}\n */\n\nrouter.get('/ping', (request, response) => {\n  logger.info('[+] In the ping');\n  return successResponse(response, '<h1>Pong from ECommerce server!</h1>','OK');\n});\n\nmodule.exports = router;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e6951aaf7f72dc0ac433a291189f9a4311f7e5fd","contentHash":"5c9cc460174c7c7a653de32604c162296f1f544ce1a54b9b85327789be216da9"},"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/config/config.js":{"path":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/config/config.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":14,"column":2}}},"fnMap":{},"branchMap":{"0":{"loc":{"start":{"line":5,"column":10},"end":{"line":5,"column":34}},"type":"binary-expr","locations":[{"start":{"line":5,"column":10},"end":{"line":5,"column":26}},{"start":{"line":5,"column":30},"end":{"line":5,"column":34}}],"line":5},"1":{"loc":{"start":{"line":10,"column":10},"end":{"line":10,"column":47}},"type":"binary-expr","locations":[{"start":{"line":10,"column":10},"end":{"line":10,"column":32}},{"start":{"line":10,"column":36},"end":{"line":10,"column":47}}],"line":10},"2":{"loc":{"start":{"line":11,"column":10},"end":{"line":11,"column":43}},"type":"binary-expr","locations":[{"start":{"line":11,"column":10},"end":{"line":11,"column":32}},{"start":{"line":11,"column":36},"end":{"line":11,"column":43}}],"line":11},"3":{"loc":{"start":{"line":12,"column":12},"end":{"line":12,"column":50}},"type":"binary-expr","locations":[{"start":{"line":12,"column":12},"end":{"line":12,"column":32}},{"start":{"line":12,"column":36},"end":{"line":12,"column":50}}],"line":12}},"s":{"0":1},"f":{},"b":{"0":[1,0],"1":[1,0],"2":[1,0],"3":[1,0]},"inputSourceMap":{"version":3,"sources":["config.js"],"names":["module","exports","server","port","process","env","PORT","NODE_ENV","mongodb","host","MONGO_HOST","MONGO_PORT","dbName","MONGO_DB"],"mappings":";;AAAAA,MAAM,CAACC,OAAP,GAAiB;AACfC,EAAAA,MAAM,EAAE;AACNC,IAAAA,IAAI,EAAEC,OAAO,CAACC,GAAR,CAAYC,IAAZ,IAAoB,IADpB;AAEND,IAAAA,GAAG,EAAED,OAAO,CAACC,GAAR,CAAYE,QAFX,CAGN;;AAHM,GADO;AAMfC,EAAAA,OAAO,EAAE;AACPC,IAAAA,IAAI,EAAEL,OAAO,CAACC,GAAR,CAAYK,UAAZ,IAA0B,WADzB;AAEPP,IAAAA,IAAI,EAAEC,OAAO,CAACC,GAAR,CAAYM,UAAZ,IAA0B,OAFzB;AAGPC,IAAAA,MAAM,EAAER,OAAO,CAACC,GAAR,CAAYQ,QAAZ,IAAwB;AAHzB;AANM,CAAjB","sourceRoot":"/Users/rahulgolash/Rahul/Professional/Assignments/ecommerce/ecommerce-server/src/config/","sourcesContent":["module.exports = {\n  server: {\n    port: process.env.PORT || 3999,\n    env: process.env.NODE_ENV,\n    // eslint-disable-next-line no-inline-comments\n  },\n  mongodb: {\n    host: process.env.MONGO_HOST || 'localhost',\n    port: process.env.MONGO_PORT || '27017',\n    dbName: process.env.MONGO_DB || 'ecommercesku',\n  },\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2d93c85d97f69bfb25c9f3c133b310710284c6eb","contentHash":"ca8839fd906babd4b20de81dd9c093de1142324cea08c4d77fa162834ad9bc44"}}