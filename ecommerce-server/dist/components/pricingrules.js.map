{"version":3,"sources":["../../src/components/pricingrules.js"],"names":["logger","require","PricingRules","constructor","skus","error","forEach","data","info","sku","name","price","img","products","length","calculateTotal","items","vgaNumber","mbpNumber","item","number","itemToPrice","getPriceOfSKU","itemPrice","i","product","module","exports","window"],"mappings":"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","sourcesContent":["'use strict';\nconst logger = require('../logger/logger');\n\n/**\n * Represents Pricing Rules applicable for calculating total price\n */\nclass PricingRules {\n  /**\n   * Represents PricingRules.\n   * @constructor\n   * @param {list} skus list of skus from MongoDB\n   */\n  constructor(skus) {\n    if (!skus) {\n      logger.error('[+] getSKUs -- error getting skus from mongoDB!');\n    }\n    skus.forEach((data) => {\n      logger.info(`[+] ECommerce service has ${data.sku}, ${data.name}, ${data.price}, ${data.img}.`);\n    });\n    this.products = skus;\n    logger.info(`[+] Total number of products in pricingRules ${this.products.length}`);\n  }\n\n  /**\n   * Item of which price to be calculated\n   * @param {list} items of scanned items\n   * @return {number} price\n   */\n  calculateTotal(items) {\n    logger.info(`[+] Total number of checkedout items in pricingRules ${items.length}`);\n\n    // 1. We're going to have a 3 for 2 deal on Apple TVs. For example, if you buy 3 Apple TVs, you will pay the price of 2 only\n    // 2. The brand new Super iPad will have a bulk discounted applied, where the price will drop to $499.99 each, if someone buys more than 4\n    // 3. We will bundle in a free VGA adapter free of charge with every MacBook Pro sold\n    let calculateTotal = 0;\n    let vgaNumber = 0,\n      mbpNumber = 0;\n    items.forEach((item) => {\n      if (item.sku === 'vga') {\n        vgaNumber = item.number;\n      } else if (item.sku === 'mbp') {\n        mbpNumber = item.number;\n      }\n    });\n    if (mbpNumber > 0) {\n      vgaNumber -= mbpNumber;\n      if (vgaNumber < 0) {\n        vgaNumber = 0;\n      }\n    }\n    items.forEach((item) => {\n      if (item.sku === 'atv') {\n        let itemToPrice = item.number;\n        if (item.number >= 3) {\n          itemToPrice -= 1;\n        }\n        calculateTotal += this.getPriceOfSKU(item.sku) * itemToPrice;\n      } else if (item.sku === 'ipd') {\n        let itemPrice = this.getPriceOfSKU(item.sku);\n        if (item.number > 4) {\n          itemPrice = 499.99;\n        }\n        calculateTotal += itemPrice * item.number;\n      } else if (item.sku === 'mbp') {\n        let itemPrice = this.getPriceOfSKU(item.sku);\n        calculateTotal += itemPrice * item.number;\n      } else if (item.sku === 'vga') {\n        let itemPrice = this.getPriceOfSKU(item.sku);\n        calculateTotal += itemPrice * vgaNumber;\n      }\n    });\n    return calculateTotal;\n  }\n\n  /**\n   * Item of which price to be calculated\n   * @param {item} sku item\n   * @return {number} price\n   */\n  getPriceOfSKU(sku) {\n    for (let i = 0; i < this.products.length; i++) {\n      let product = this.products[i];\n      if (product.sku === sku) {\n        return product.price;\n      }\n    }\n    return -1;\n  }\n}\n\nif (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n  module.exports = PricingRules;\n} else {\n  window.PricingRules = PricingRules;\n}\n"],"file":"pricingrules.js"}